<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>S02- Onboard Architecture specification Part10 - APC-II</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="pandoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">S02- Onboard Architecture specification Part10 - APC-II</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#concepts-and-terminology">1. Concepts and Terminology</a>
<ul>
<li><a href="#itxpt-data-dictionary-concepts">1.1. ITxPT Data Dictionary Concepts</a></li>
<li><a href="#other-terminology">1.2. Other Terminology</a></li>
</ul></li>
<li><a href="#apc-ii-solution-description">2. APC-II Solution description</a>
<ul>
<li><a href="#relation-to-itxpt-s02p07-apc-specification">2.1. Relation to ITxPT S02P07 APC Specification</a></li>
<li><a href="#purpose-of-apc">2.2. Purpose of APC</a></li>
<li><a href="#high-level-solution">2.3. High Level solution</a></li>
<li><a href="#what-is-not-standardized">2.4. What is not standardized</a></li>
<li><a href="#passenger-spaces">2.5. PASSENGER SPACES</a></li>
</ul></li>
<li><a href="#conceptual-data-model">3. Conceptual Data Model</a></li>
<li><a href="#detailed-data-model">4. Detailed Data Model</a>
<ul>
<li><a href="#uniqueness-of-ids">4.1. Uniqueness of IDs</a></li>
<li><a href="#entrances">4.2. Entrances</a>
<ul>
<li><a href="#sensor-entrance-mapping">4.2.1. Sensor Entrance Mapping</a></li>
<li><a href="#external-entrances">4.2.2. External entrances</a></li>
</ul></li>
<li><a href="#relations-of-spaces">4.3. Relations of Spaces</a>
<ul>
<li><a href="#entrance-entrance-mappings">4.3.1. Entrance-Entrance Mappings</a></li>
<li><a href="#multiple-sensors-for-one-entrance">4.3.2. Multiple sensors for one Entrance</a></li>
</ul></li>
<li><a href="#no-spaces-defined">4.4. No Spaces defined</a></li>
</ul></li>
<li><a href="#data-format-json">5. Data Format JSON</a>
<ul>
<li><a href="#json-schemas">5.1. JSON Schemas</a></li>
<li><a href="#api-version">5.2. API version</a></li>
<li><a href="#apc-static-data">5.3. APC Static Data</a>
<ul>
<li><a href="#sensorid-to-entranceid-mapping">5.3.1. SensorId to entranceId mapping</a></li>
<li><a href="#passenger-space-capacity">5.3.2. PASSENGER SPACE CAPACITY</a></li>
<li><a href="#passenger-space">5.3.3. PASSENGER SPACE</a></li>
<li><a href="#entrance-for-passenger-space">5.3.4. ENTRANCE FOR PASSENGER SPACE</a></li>
<li><a href="#entrance-mapping">5.3.5. Entrance Mapping</a></li>
</ul></li>
<li><a href="#apc-counting-data">5.4. APC Counting Data</a>
<ul>
<li><a href="#time-synchronization">5.4.1. Time synchronization</a></li>
<li><a href="#quality-factor">5.4.2. Quality Factor</a></li>
<li><a href="#apc-objectcount-structure">5.4.3. APC objectCount structure</a></li>
<li><a href="#passenger-count-triggers">5.4.4. Passenger Count Triggers</a></li>
<li><a href="#passenger-entrance-count">5.4.5. PASSENGER ENTRANCE COUNT</a></li>
<li><a href="#passenger-space-occupancy-count">5.4.6. PASSENGER SPACE OCCUPANCY COUNT</a></li>
<li><a href="#passenger-space-occupancy-ratio">5.4.7. PASSENGER SPACE OCCUPANCY RATIO</a></li>
<li><a href="#passenger-space-entrance-count">5.4.8. PASSENGER SPACE ENTRANCE COUNT</a></li>
</ul></li>
<li><a href="#passenger-space-count-reset">5.5. Passenger Space Count reset</a></li>
</ul></li>
<li><a href="#transport-mqtt-using-json-format">6. Transport MQTT using JSON format</a>
<ul>
<li><a href="#general-requirements">6.1. General Requirements</a></li>
<li><a href="#security-considerations">6.2. Security Considerations</a></li>
<li><a href="#performance-considerations">6.3. Performance Considerations</a></li>
<li><a href="#functional-group-and-provider-names">6.4. Functional Group and Provider Names</a></li>
<li><a href="#mqtt-apc-topic-tree">6.5. MQTT APC Topic tree</a></li>
<li><a href="#note-on-provider-ids">6.6. Note on Provider IDs</a></li>
<li><a href="#static-data">6.7. Static Data</a></li>
<li><a href="#entrance_counts-providers">6.8. <code>entrance_counts</code> Providers</a>
<ul>
<li><a href="#inventory">6.8.1. Inventory</a></li>
</ul></li>
<li><a href="#space_counts-providers">6.9. <code>space_counts</code> Providers</a>
<ul>
<li><a href="#reset_request">6.9.1. reset_request</a></li>
<li><a href="#inventory-1">6.9.2. Inventory</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<p><strong>Version History</strong></p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 25%" />
<col style="width: 39%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Version</th>
<th>Description</th>
<th>Author</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>early June 2021</td>
<td>0.1.0</td>
<td>Initial TWG draft</td>
<td>OAB</td>
</tr>
<tr class="even">
<td>2021-06-24</td>
<td>0.2.0</td>
<td>Updates after first walk through</td>
<td>OAB</td>
</tr>
<tr class="odd">
<td>2021-07-06</td>
<td>0.2.1</td>
<td>Minor update after comments</td>
<td>OAB</td>
</tr>
<tr class="even">
<td>2021-07-08</td>
<td>0.3.0</td>
<td>Some update after TWG03 meeting. Topic tree rework, reset function, OCCUPANCY RATIO msg, etc</td>
<td>OAB</td>
</tr>
</tbody>
</table>
<table style="width:99%;">
<colgroup>
<col style="width: 98%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Information Technology for Public Transport</strong> (ITxPT)<br />
Rue Sainte-Marie 6, B-1080 Brussels | Belgium<br />
Tel +32 (0)2 673 61 00 | Fax +32 (0)2 660 10 72<br />
<a href="mailto:info@itxpt.org" class="email">info@itxpt.org</a> | <a href="http://www.itxpt.org">www.itxpt.org</a></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">International non-profit making association (AISBL) incorporated by Royal Decree and the Belgian Ministry of Justice under Belgian law WL22/16.729 on 4<sup>th</sup> May 2016.</td>
</tr>
</tbody>
</table>
<p><strong>Important notice</strong></p>
<p>The present document can be downloaded from https://wiki.itxpt.org/index.php?title=ITxPT_Technical_Specifications.</p>
<p>The present document may be made available in electronic versions and/or in print. The content of any electronic and/or print versions of the present document shall not be modified without the prior written authorization of ITxPT. In case of any existing or perceived difference in contents between such versions and/or in print, the prevailing version of an ITxPT deliverable is the one made publicly available in PDF format at https://wiki.itxpt.org.</p>
<p>Users of the present document should be aware that the document may be subject to revision or change of status. Information on the current status of this and other ITxPT documents is available at https://wiki.itxpt.org/index.php?title=Releases.</p>
<p>If you find errors in the present document, please send your comment to the technical support https://itxpt.org/membership/contact-us.</p>
<p><strong>Copyright Notification</strong></p>
<p>All rights reserved. This document has been produced and approved by ITxPT and represents the views of those members who participated.</p>
<p>The content of the PDF version shall not be modified. The copyright and the foregoing restriction extend to reproduction in all media.</p>
<p>Users of the present document should be aware that the document may be subject to revision or change of status. Information on the current status of this and other ITxPT documents is available at <a href="https://itxptorg.sharepoint.com/sites/ITxPTTeam/Shared%20Documents/Specifications/2.%20Next%20release/2020%20v2.1.1/S02/Part04-%20FMStoIP/wiki.txpt.org">wiki.txpt.org</a></p>
<p>© ITxPT 2021<br />
All rights reserved.</p>
<p># Modal verbs terminology</p>
<p>In the present document "<strong>shall</strong>", "<strong>shall not</strong>", "<strong>should</strong>", "<strong>should not</strong>", "<strong>may</strong>", "<strong>need not</strong>", "<strong>will"</strong>, <strong>"will not"</strong>, "<strong>can</strong>" and "<strong>cannot</strong>" are to be interpreted as described below.</p>
<p>"<strong>must</strong>" and "<strong>must not</strong>" are <strong>NOT</strong> allowed in ITxPT deliverables except when used in direct citation.</p>
<p>In order to be able to claim compliance with an ITXPT deliverable, the user needs to be able to identify the requirements that are obligatory. The user also needs to be able to distinguish these requirements from other provisions where there is a certain freedom of choice.</p>
<p>This clause is clearly stating the verbal form that shall be used to express a particular kind of provision, i.e. a requirement, a recommendation or a permission.</p>
<p>In the first column of tables T1 to T4 the verbal form that shall be used to express each kind of provision is given. The equivalent expressions given in the second column may be used only in exceptional cases when the form given in the first column cannot be used for linguistic reasons</p>
<p>NOTE: Only singular forms are shown.</p>
<p>The verbal forms shown in Table T1 shall be used to indicate <strong>requirements</strong> strictly to be followed in order to conform to the standard and from which no deviation is permitted. For example, the requirements to be followed may relate to values, actions, features to be supported and/or used or presence/absence or optional elements.</p>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="header">
<th>Verbal form</th>
<th>Equivalent expressions used in exceptional cases[^1]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>shall</strong></td>
<td>is to<br>is required to<br>it is required that<br>has to<br>only ... is permitted<br>it is necessary</td>
</tr>
<tr class="even">
<td><strong>shall not</strong></td>
<td>is not allowed / permitted / acceptable /permissible<br>is required to be not<br>is required that … be not<br>is not to be</td>
</tr>
</tbody>
</table>
<p>Table T1 - Requirement</p>
<p>The verbal forms shown in Table T2 shall be used to indicate that among several possibilities one is <strong>recommended</strong> as particularly suitable, without mentioning or excluding others, or that a certain course of action is preferred but not necessarily required, or that (in the negative form) a certain possibility or course of action is deprecated but not prohibited. For example, the recommendations may relate to values, actions, features to be supported and/or used or presence/absence or optional elements.</p>
<table style="width:99%;">
<colgroup>
<col style="width: 23%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="header">
<th>Verbal form</th>
<th>Equivalent expressions used in exceptional cases<sup>1</sup></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>should</strong></td>
<td><p>it is recommended that</p>
<p>ought to</p></td>
</tr>
<tr class="even">
<td><strong>should not</strong></td>
<td><p>should not it is not recommended that</p>
<p>ought not to</p></td>
</tr>
</tbody>
</table>
<p>Table T2 - Recommendation</p>
<p>The verbal forms shown in Table T3 shall be used to indicate what is <strong>permitted</strong> by the ITXPT deliverable, which can be values, actions, support and /or use of features or presence/absence of optional elements.</p>
<table style="width:94%;">
<colgroup>
<col style="width: 19%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="header">
<th>Verbal form</th>
<th>Equivalent expressions used in exceptional cases<sup>1</sup></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>may</strong></td>
<td><p>is permitted</p>
<p>is allowed</p>
<p>is permissible</p></td>
</tr>
<tr class="even">
<td><strong>may not</strong></td>
<td><p>it is not required that</p>
<p>no ... is required</p></td>
</tr>
</tbody>
</table>
<p>Table T3 - Permission</p>
<p>The verbal forms shown in Table T4 shall be used for statements of <strong>possibility and capability</strong>, whether material, physical or causal.</p>
<table style="width:94%;">
<colgroup>
<col style="width: 19%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="header">
<th>Verbal form</th>
<th>Equivalent expressions used in exceptional cases<sup>1</sup></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>can</strong></td>
<td><p>be able to</p>
<p>there is a possibility of</p>
<p>it is possible to</p></td>
</tr>
<tr class="even">
<td><strong>cannot</strong></td>
<td><p>be unable to</p>
<p>there is no possibility of</p>
<p>it is not possible to</p></td>
</tr>
</tbody>
</table>
<p>Table T4 - Possibility and capability</p>
<p>The verbal forms shown in Table T5 shall be used to indicate <strong>behaviour</strong> of equipment or sub-systems <strong>outside</strong> the scope of the ITXPT deliverable in which they appear. For example, in an ITXPT deliverable specifying the requirements of terminal equipment, these forms shall be used to describe the expected behaviour of the network to which the terminal is connected.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Verbal form</th>
<th style="text-align: left;">Equivalent expressions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>will</strong></td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>will not</strong></td>
<td style="text-align: left;">-</td>
</tr>
</tbody>
</table>
<p>Table T5 - Inevitability</p>
<h1 id="concepts-and-terminology">1. Concepts and Terminology</h1>
<h2 id="itxpt-data-dictionary-concepts">1.1. ITxPT Data Dictionary Concepts</h2>
<p>Concepts from the ITxPT Data Dictionary is referred by UPPER CASE, when the concept definition is important.</p>
<p>The following Concepts from the ITxPT Data Dictionary are used.</p>
<p><strong>COMPOUND TRAIN</strong> - A VEHICLE TYPE composed of a sequence of more than one vehicles of the type TRAIN.</p>
<p><strong>ENTRANCE FOR PASSENGER SPACE</strong> - A PASSENGER ENTRANCE used as an entry- and/or exit- point to or from a certain PASSENGER SPACE along with information if the designated exit and entry directions of the PASSENGER ENTRANCE are aligned or reversed in relation to the PASSENGER SPACE.</p>
<p><strong>PASSENGER ENTRANCE</strong> - A physical or virtual boundary point through which passengers can enter or exit, e.g. a vehicle door. A PASSENGER ENTRANCE has a designated enter-direction and a designated exit-direction.</p>
<p><strong>PASSENGER ENTRANCE COUNT</strong> - Number of passengers and other objects that have entered and exited through a specific PASSENGER ENTRANCE during a time span or since some implicit or explicit previous time/event. A possible implementation of LOGGABLE OBJECT.</p>
<p><strong>PASSENGER SPACE</strong> - A passenger area within a VEHICLE. It may be limited to only a part of a VEHICLE such as a TRAIN ELEMENT, upper deck/lower deck, first class compartment or a bounded open space. A PASSENGER SPACE can be part of, overlap with, and be made up of other PASSENGER SPACEs.</p>
<p><strong>PASSENGER SPACE CAPACITY</strong> - The number of passengers and other objects that are present in a PASSENGER SPACE when it is at 100% capacity.</p>
<p><strong>PASSENGER SPACE ENTRANCE COUNT</strong> - Number of passengers and other objects that entered and exited a specific PASSENGER SPACE during a time span or since some implicit or explicit previous time/event. A possible implementation of LOGGABLE OBJECT. It is in essence an aggregation of relevant PASSENGER ENTRANCE COUNTs according to ENTRANCE FOR PASSENGER SPACE information.</p>
<p><strong>PASSENGER SPACE OCCUPANCY COUNT</strong> - Number of passengers and other objects that are in a PASSENGER SPACE at a given time. A possible implementation of LOGGABLE OBJECT.</p>
<p><strong>TRAIN</strong> - A VEHICLE TYPE composed of TRAIN ELEMENTs in a certain order, i.e. of wagons assembled together and propelled by a locomotive or one of the wagons.</p>
<p><strong>TRAIN ELEMENT</strong> - An elementary component of a TRAIN (e.g. wagon, locomotive).</p>
<p><strong>VEHICLE</strong> - A public transport vehicle used for carrying passengers.</p>
<h2 id="other-terminology">1.2. Other Terminology</h2>
<p>In addition the following terminology is used in the specification.</p>
<p><strong>APC:</strong> Automatic Passenger Counting</p>
<p><strong>APC Aggregator:</strong> A component/module/process/etc that generates APC data based on inputs.</p>
<p><strong>PASSENGER SPACE OCCUPANCY RATIO:</strong> A fraction describing the current level of occupancy. Should be close to PASSENGER SPACE OCCUPANCY COUNT divided by PASSENGER SPACE CAPACITY.</p>
<blockquote>
<p><strong><em>NOTE OAB:</em></strong> This should probably be added to DD.</p>
</blockquote>
<h1 id="apc-ii-solution-description">2. APC-II Solution description</h1>
<h2 id="relation-to-itxpt-s02p07-apc-specification">2.1. Relation to ITxPT S02P07 APC Specification</h2>
<p>The specification is broadly similar to S02P07, and in some aspects <em>very</em> similar. However it also changes a number of things: - Modified data structures to support Heavy Rail - Changed data format to JSON - Changed Transport to MQTT</p>
<p>As such the old specification have been kept as a Legacy specification to support existing equipment and clients/consumers, and the S02P10 APC-II specification has been introduced as a new specification</p>
<h2 id="purpose-of-apc">2.2. Purpose of APC</h2>
<p>Put some purpose here</p>
<h2 id="high-level-solution">2.3. High Level solution</h2>
<p>The APC specification specifies a few different things: - The information from Entrance (Door) Sensors - The information aggregated from Sensors (of any type) for PASSENGER SPACES - How to express how Entrances relates to Spaces, and Spaces to other Spaces.</p>
<p>The specification specifies the Data being exchanged, not where or how the Data is being processed or generated. In particular it does not contain any requirements on what is done onboard and what is done in the back office.</p>
<figure>
<img src="apc-highlevel.drawio.png" alt="Overview door based" /><figcaption aria-hidden="true">Overview door based</figcaption>
</figure>
<p>Above is a “traditional” setup using door sensors on the vehicle doors, and similar sensors between carriages. For the defined PASSENGER SPACES, in this case the entire Vehicle and the three Carriages, the Occupancy and Entries/Exits are calculated.</p>
<p>This specification does not constrain what sources/data are used for calculating the Data. A solution that uses Entrance Sensors for the Vehicle Doors, and Video analysis for tracking internal movement between Spaces is one possibility. Another would be Video analysis supported by Axle load sensors, as shown below:</p>
<figure>
<img src="apc-highlevel_video-axle.drawio.png" alt="Overview axel/video based" /><figcaption aria-hidden="true">Overview axel/video based</figcaption>
</figure>
<p>Many other configurations are possible.</p>
<h2 id="what-is-not-standardized">2.4. What is not standardized</h2>
<p>Currently the specification only standardizes the data from Entrance (Door) sensors, not e.g. Axel Load sensors. And it does not standardize any reports, e.g. Entry/exit per STOP PLACE.</p>
<h2 id="passenger-spaces">2.5. PASSENGER SPACES</h2>
<p>PASSENGER SPACES will be described more formally below. But as it the major addition compared to the S02P07 APC Specification, and the key concept to support Heavy Rail Requirements, a bit of less formal explanation is added here to aid the readability of the specification.</p>
<p>The simplest configuration is a Vehicle with one Space for the entire vehicle, and one or more Entrances:</p>
<figure>
<img src="apc-spaces_bus.drawio.png" alt="Spaces - Simple Vehicle" /><figcaption aria-hidden="true">Spaces - Simple Vehicle</figcaption>
</figure>
<p>For a more complicated configuration there is still the Space for the entire Vehicle, but there are also Spaces for parts of the Vehicle:</p>
<figure>
<img src="apc-spaces_ddbus.drawio.png" alt="Spaces - Bilevel Vehicle" /><figcaption aria-hidden="true">Spaces - Bilevel Vehicle</figcaption>
</figure>
<p>In this Double Deck Bus, APC data can be reported for the entire Vehicle (Space: Vehicle), but also for the upper floor (Space: Upper floor) and the lower floor (Space: Lower floor).</p>
<p>There is no limit in the specification how Spaces are nested, or how many nested spaces there is.</p>
<figure>
<img src="apc-spaces_emu.drawio.png" alt="Spaces - Complex Vehicle" /><figcaption aria-hidden="true">Spaces - Complex Vehicle</figcaption>
</figure>
<p>In this three carriage EMU there is a Space for the entire Vehicle, one Space for each of the three Carriages, and then one of the Carriages is further divided in a 1st-Class Space and an Economy-Class Space. Here are also the Entrances marked, both the external entrances (orange solid, into/out of the Vehicle) and the internal entrances (orange dotted, between Spaces).</p>
<p>And it does not stop there. The way this specification supports seat occupancy reporting is by defining a <em>Space for each seat</em>, and reporting the Occupancy on the “seat Space”.</p>
<h1 id="conceptual-data-model">3. Conceptual Data Model</h1>
<figure>
<img src="apc-conceptual-data-model.drawio.png" alt="Conceptual Data Model" /><figcaption aria-hidden="true">Conceptual Data Model</figcaption>
</figure>
<p>PASSENGER SPACE, PASSENGER SPACE CAPACITY and PASSENGER ENTRANCE are all statically configured (they will not change during operation) and are shown in darker colour. PASSENGER ENTRANCE COUNT, PASSENGER SPACE ENTRANCE COUNT, and PASSENGER SPACE OCCUPANCY COUNT all contain passenger count data and will change regularly during operation and are shown in lighter colour.</p>
<h1 id="detailed-data-model">4. Detailed Data Model</h1>
<p>The Conceptual Data Model above shows how the defined Concepts relates to each other. But it does not provide enough details to be the basis of a standard format.</p>
<p>To do that additional details are provided.</p>
<figure>
<img src="apc-detailed-data-model.drawio.png" alt="Detailed Data Model" /><figcaption aria-hidden="true">Detailed Data Model</figcaption>
</figure>
<p>The darker colour is used for static data, while the lighter colour is used for Counting data.</p>
<p>A number of things have changed. Relationships between different objects are now set by spaceId and entranceId, as <em>indicated</em> by the dotted lines.</p>
<p>PASSENGER ENTRANCE is not present as a separate class, as it did not carry any information that needed stand-alone representation.</p>
<h2 id="uniqueness-of-ids">4.1. Uniqueness of IDs</h2>
<p>There is no namespaces for Space, Entrance and Sensor IDs. All IDs must be unique within the Vehicle it is used.</p>
<p>It is <em>strongly</em> recommended that all sensor IDs be globally unique, so that one sensor can never be mistaken for another.</p>
<p>The uniqueness of entrance and sensor IDs is not a problem for Vehicles that are fixed, e.g. a bus. In these Vehicles entrance IDs can be be “door1” and “door2”, space IDs “forward”, “middle”, and “rear” or something else simple.</p>
<p>But in a Vehicle made up of potentially interchangeable elements, typically a TRAIN made up of TRAIN ELEMENTS, it needs to be ensured that entrance and space IDs are unique regardless of which TRAIN ELEMENTS make up the the TRAIN.</p>
<p>It must either be ensured that the IDs are unique for all the possible combinations of TRAIN ELEMENTS, <em>or</em> each TRAIN must set (new) unique entrance and space IDs each time the makeup of the TRAIN changes.</p>
<h2 id="entrances">4.2. Entrances</h2>
<p>One Entrance may belong to multiple Spaces. E.g. an external entrance, Door7, may belong to the Vehicle Space, to the Carriage1 Space, and to the Carriage1-SilentCompartment Space. When one passenger enters through Door7 this is only one new passenger in the Vehicle, one new passenger in Carriage1 and one new passenger in Carriage1-SilentCompartment.</p>
<h3 id="sensor-entrance-mapping">4.2.1. Sensor Entrance Mapping</h3>
<p>The SensorEntranceMapping entity allows the sensors to not know their entranceId, as long as another actor supplies that. It also make it possible to have two, or more, sensors for one entrance, e.g. a left and right sensor for a wide entrance. When two or more sensorIDs are mapped to <em>the same entranceID</em> the the entry/exit of that PASSENGER ENTRANCE is the <strong>sum</strong> of the PASSENGER ENTRANCE COUNTs that are reported with sensorIDs mapped that entrance.</p>
<h3 id="external-entrances">4.2.2. External entrances</h3>
<p>An entrance of type EXTERNAL by definition leads into/out-of the Vehicle. Because of this the Vehicle Space does not <em>need to</em> contain any external entrances. Instead these can be found by looking that the Spaces that the Vehicle Space contains. E.g. for a three car train, the Vehicle Space may have an empty entrances list, while the external doors found in the car1, car2 and car3 Spaces’ entrance lists.</p>
<h2 id="relations-of-spaces">4.3. Relations of Spaces</h2>
<p>Each Space that is not a Vehicle Space will be next to one or more other spaces. Currently Spaces have no direct relations to each other. Which spaces connects to which other spaces must be determined by looking at the entrances each space have. Two spaces that contain the same entrance connect to each other.</p>
<p>If the entrances are ALIGNED, then on entry a PASSENGER will be present in both Spaces. If the entrances are REVERSED, then a PASSENGER will enter one Space while exiting the others.</p>
<h3 id="entrance-entrance-mappings">4.3.1. Entrance-Entrance Mappings</h3>
<p>In cases where two spaces are next to each other, but <em>don’t</em> have the same entrance ID on what is the passage between them, this is resolved by and Entrance-Entrance Mapping. This will then be used to determine that e.g. the entrance “car123-rear” for space “car123” is now connected to the entrance “car345-front” for space “car345”. Now a car123-rear exit will be a car345-front entry, and vice versa.</p>
<p>A mapped entrance could have one Entrance Sensor, so that a PASSENGER ENTRANCE COUNT will be generated with one of the entrance IDs, but not the other. Or there could be a sensor for each of them, so that for each PASSENGER entry/exit there will be a PASSENGER ENTRANCE COUNT generated with each of the entrance IDs. The APC Aggregator needs to account for this, and handle both possibilities.</p>
<h3 id="multiple-sensors-for-one-entrance">4.3.2. Multiple sensors for one Entrance</h3>
<p>In some cases there may be multiple independent sensors for one PASSENGER ENTRANCE. E.g. there may be both a door sensor <em>and</em> a video based monitoring system, both reporting entry/exit data on the same physical entrance. In these cases the systems needs to report entrance data using <em>different</em> entrance Ids, and then an Entrance-Entrance Mapping is used to define that these sensors are covering the same PASSENGER ENTRANCE.</p>
<p>When PASSENGER ENTRANCE COUNTs are reported with <em>different</em> entranceIDs that are mapped to the same entrance, these counts are <em>complimentary</em>. The APC Aggregator may use counts reported with one entranceID, or use counts reported with several entranceIDs to create better quality data</p>
<h2 id="no-spaces-defined">4.4. No Spaces defined</h2>
<p>If there are NO Spaces defined for a Vehicle, it shall be assumed that it is a single Space Vehicle. All PASSENGER ENTRANCE COUNT data items should be assumed to be EXTERNAL and PASSENGER SPACE OCCUPANCY COUNT, PASSENGER SPACE ENTRANCE COUNT, etc generated accordingly.</p>
<p>Since a single Space is assumed, both sensor ID and entrance ID shall be accepted as identification of a PASSENGER ENTRANCE COUNT data item, without a need for a SensorEntranceMapping.</p>
<h1 id="data-format-json">5. Data Format JSON</h1>
<p>The Data Format for APC-II is JSON. As this is a Data Centric specification more formats could be added in future, but no such needs have been identified for now.</p>
<p>The Data Format JSON section is organized in two sections. First is the static data that provides the information about how the Vehicle is “organized”, and then is the data that contains the Passenger Counts themselves.</p>
<h2 id="json-schemas">5.1. JSON Schemas</h2>
<p>For brevity the JSON schemas are not included in this document, but can be found on the ITxPT github. For APC-II the schemas are regarded as part of the specification with no distinction in priority. If a conflict or contradiction is found between the schemas and this document an issue should be raised with ITxPT, which will resolve the problem with a minimum impact.</p>
<p>As part of JSON example <code>$schema</code> property name is used to show which JSON schema applies. The <code>$schema</code> property should not be part of data published by the implementation.</p>
<h2 id="api-version">5.2. API version</h2>
<p>The property <code>apiVersion</code> is used to track the current version of the data. This is <em>not</em> the ITxPT specification version, which may change without the data being affected.</p>
<blockquote>
<p><strong><em>NOTE OAB:</em></strong> <code>apiVersion</code> a good candidate for more general standardization, perhaps as a Data Dictionary standard type.</p>
</blockquote>
<h2 id="apc-static-data">5.3. APC Static Data</h2>
<p>Static Data describes how the Vehicle is configured. It should change only when the vehicle is reconfigured, which should be never for many Vehicles and seldom for the others. In particular the static data will not change during operation. The exception to this could be COMPOUND TRAINs, but even there each TRAIN would stay fixed.</p>
<h3 id="sensorid-to-entranceid-mapping">5.3.1. SensorId to entranceId mapping</h3>
<p>For Entrance Sensors that identify with the sensorId, a mapping of the sensorId to entranceId must be provided.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/sensorId-entranceId-mapping.json&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;sensorId&quot;</span><span class="fu">:</span> <span class="st">&quot;AcmeCo-23456789&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;car2397-door7&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>This is used by the APC Aggregator to know that a PASSENGER ENTRANCE COUNT data item with a sensorId(s) belong to a specific entranceId. While this could be posted by anyone, the use case is that sensors don’t (need to) know where they are in the Vehicle, but this is known to some other onboard or back office system.</p>
<h3 id="passenger-space-capacity">5.3.2. PASSENGER SPACE CAPACITY</h3>
<p>This is the number of Objects that a Space (Vehicle) can accommodate at 100% utilization.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-SPACE-CAPACITY.json&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;Vehicle&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;capacity&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;see objectCount def&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;seated&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;see objectCount def&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;standing&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;see objectCount def&gt;&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>This structure contains the maximum number of <em>each</em> objects the Space can accommodate at at 100% utilization. E.g. a Space that can fit 90 adults, 120 children, 2 wheelchairs, and 4 prams, cannot fit these <em>at the same time</em> but would have a 100% occupancy at 60 adults, 25 children, 1 wheelchair and 2 prams.</p>
<p><code>occupancy</code> shall always be present. <code>seated</code> and <code>standing</code> are optional, and shall not be part of the structure if not known/present.</p>
<h3 id="passenger-space">5.3.3. PASSENGER SPACE</h3>
<p>The space structures is what APC count structures can be reported on.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-SPACE.json&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;VIN1234567HG&quot;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceType&quot;</span><span class="fu">:</span> <span class="st">&quot;VEHICLE&quot;</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entrances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;door1&quot;</span><span class="fu">,</span> <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;EXTERNAL&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;ALIGNED&quot;</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;door2&quot;</span><span class="fu">,</span> <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;EXTERNAL&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;ALIGNED&quot;</span><span class="fu">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;isPartOfSpaces&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;containsSpaces&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;forward&quot;</span><span class="ot">,</span> <span class="st">&quot;mid-door-area&quot;</span><span class="ot">,</span> <span class="st">&quot;rear&quot;</span><span class="ot">]</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Above is a Vehicle Space with three sub-spaces with two of these sub-spaces below</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-SPACE.json&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;mid-door-area&quot;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceType&quot;</span><span class="fu">:</span> <span class="st">&quot;wheelchair-standing-area&quot;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entrances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;door2&quot;</span><span class="fu">,</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;EXTERNAL&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;ALIGNED&quot;</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;endForwardSeating&quot;</span><span class="fu">,</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;INTERNAL&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;REVERSED&quot;</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;startRearSeating&quot;</span><span class="fu">,</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;INTERNAL&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;REVERSED&quot;</span><span class="fu">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;isPartOfSpaces&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;containsSpaces&quot;</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-SPACE.json&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;rear-area&quot;</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceType&quot;</span><span class="fu">:</span> <span class="st">&quot;seating-area&quot;</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entrances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;startRearSeating&quot;</span><span class="fu">,</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;INTERNAL&quot;</span><span class="fu">,</span> <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;ALIGED&quot;</span><span class="fu">}</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;isPartOfSpaces&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;containsSpaces&quot;</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The two spaces are linked by both having the “startRearSeating” entrance.</p>
<h4 id="passenger-space---spacetype">5.3.3.1. PASSENGER SPACE - spaceType</h4>
<p>The intention with spaceType is to make data more readable, but also to allow processes that process output from the APC Aggregator to recognize a few common Space types, and generate reports (or other output) on those without understanding the specific naming of Spaces in all Vehicles.</p>
<p>ÏTxPT standardized names are UPPER CASE, while other names should be lower case, avoiding conflict between non-standard names and future additional standard additions.</p>
<p><strong>Standardized spaceTypes</strong></p>
<p><code>COMPOUND_TRAIN</code> - A space made up of several <code>TRAINS</code>/<code>VEHICLES</code></p>
<p><code>VEHICLE</code> - A Space capable of independent movement. Expectation is that passengers can move between any Spaces that make up the <code>VEHICLE</code>.</p>
<p><code>TRAIN_ELEMENT</code> - A car/carriage that makes up part of <code>VEHICLE</code></p>
<p><code>UPPER_LEVEL</code> - Upper level of a bi-level <code>VEHICLE</code>/<code>TRAIN_ELEMENT</code></p>
<p><code>LOWER_LEVEL</code> - Lower level of a bi-level <code>VEHICLE</code>/<code>TRAIN_ELEMENT</code></p>
<p><code>STAIRCASE</code> - A staircase between different levels.</p>
<p><code>WHEELCHAIR</code> - An area with one or more wheelchair spaces.</p>
<p><code>SEAT</code> - A seat for a single <code>PASSENGER</code></p>
<p><code>BENCH_SEAT</code> - A longer seat that may fit two or more PASSENGERs.</p>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> More of these we should have? The standard don’t <em>require</em> any action so relatively harmless to add more types I would think.</p>
</blockquote>
<h3 id="entrance-for-passenger-space">5.3.4. ENTRANCE FOR PASSENGER SPACE</h3>
<p>The entrance list of a Space consists of ENTRANCE FOR PASSENGER SPACE objects. Each object is made up of</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/ENTRANCE-FOR-PASSENGER-SPACE.json&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;door2&quot;</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entranceType&quot;</span><span class="fu">:</span> <span class="st">&quot;EXTERNAL&quot;</span><span class="fu">,</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;direction&quot;</span><span class="fu">:</span> <span class="st">&quot;ALIGNED&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li>entranceId must be unique in the Vehicle</li>
<li>entranceType must be either “EXTERNAL” or “INTERNAL”</li>
<li>direction must be either “ALIGNED” or “REVERSED”</li>
</ul>
<p>“ALIGNED” is used when any associated entrance sensor has entry/exit events of the same direction. “REVERSED” is used when entry/exit events are opposite, and an entry event for the entrance (sensor) is a exit event for the Space. If there is no associated sensor the value shall be null.</p>
<h3 id="entrance-mapping">5.3.5. Entrance Mapping</h3>
<p>Entrance Mapping is used when two entrances are next to each other or overlapping, and this makes two entrances work as one entrance. A typical use case would be two TRAIN ELEMENTS pared up so the entrance on the rear of the first carriage is the entrance at the front of the second.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/entranceId-mapping.json&quot;</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entranceId1&quot;</span><span class="fu">:</span> <span class="st">&quot;car1287-rearEntrance&quot;</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entranceId2&quot;</span><span class="fu">:</span> <span class="st">&quot;car2397-frontEntrance&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><code>ALIGNED</code> is used when an entry/exit is the same event for both entrances. <code>REVERSED</code> is used when an entry event for one is an exit event for the other.</p>
<h2 id="apc-counting-data">5.4. APC Counting Data</h2>
<p>Counting data is the data that are actually wanted! These data items contains the information about entry/exit and occupancy of vehicles/spaces.</p>
<h3 id="time-synchronization">5.4.1. Time synchronization</h3>
<p>APC Counting Data contains timestamps, and data analysis relies on the timestamps of different Providers to be in sync. Producers of APC Counting Data shall ensure that the timestamp is based on a synchronized UTC time. Onboard this means using the onboard SNTP service according to ITxPT S02P02 specification.</p>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Perhaps not the best fit for the “Data format JSON” section. Perhaps have an “Other requirements” section between “Detailed Data Model” and “Data format JSON”? Or perhaps it is a good fit, as other formats may use other mechanisms to connect data?</p>
</blockquote>
<h3 id="quality-factor">5.4.2. Quality Factor</h3>
<p>The counting data all all have a quality factor, <code>qf</code>, which indicates the quality of the <em>data</em>. It applies to the changes since the last transmission. It has the values - <code>HIGH</code> - No known problem with data. - <code>MODERATE</code> - Data <em>may</em> have some problems, but usable. - <code>LOW</code> - Data <em>may</em> have major differences with the actual data. - <code>ERROR</code> - The data is not reliable, and should not trusted.</p>
<p><code>qf</code> is the quality of the <em>data</em> and not (necessarily) the state of the sensor/detection. E.g. a video based system may work fine, but have low confidence in reported data because someone carried an Billy bookshelf onboard and is obscuring most of the camera field of view.</p>
<blockquote>
<p><strong><em>NOTE OAB:</em></strong> <code>qf</code> could be a good candidate for more general standardization, perhaps as a Data Dictionary standard type.</p>
</blockquote>
<h3 id="apc-objectcount-structure">5.4.3. APC objectCount structure</h3>
<p>The objectCount structure is used in several structures to count objects that enters, exits or are present in vehicles.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/apc-object-count.json&quot;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;adults&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">21</span><span class="fu">},</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">},</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;wheelchairs&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">},</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prams&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">},</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;bikes&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">},</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;luggage&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;composition&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;xs&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">},</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;small&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">},</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;medium&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">},</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;large&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">},</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;xl&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">}</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;animals&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;composition&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;small&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">},</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;medium&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">},</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;large&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">}</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;others&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span> </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;ext_custom&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;flatpack_furniture&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">}}</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>In example above <code>"ext_customer": {"flatpack_furniture": {"count": 1}}</code> is a custom extension.</p>
<p>The object count is reported on several defined object types.</p>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Object types here only a proposal. Also we need to think about sensors / detection methods that support a subset of defined types. Are all of these mandatory to be ITxPT compliant? Are any?</p>
</blockquote>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> There are multiple object types, which cannot cleanly be translated between each other. 1 adult != 1 child; 1 wheelchair != 1 adult; etc. Should there be some toplevel “passenger = float-nbr” or “adultEquiv = float-nbr” that is a estimate how many adult-equivalents the total sum makes up? Perhaps also as part of each type?</p>
</blockquote>
<p>Each object type has a structure containing a “count” property with the number of items counted. This can be further broken down into standardized subtypes via the “composition” property, with subtypes having a “count” property of their own. Custom</p>
<p>The defined types are:</p>
<ul>
<li><code>adults</code> - A passenger that is not a child</li>
<li><code>children</code> - Usually delimited from adults by a height threshold</li>
<li><code>wheelchairs</code> - TBD</li>
<li><code>prams</code> - TBD</li>
<li><code>bikes</code> - A bike. This includes all types of bikes, including motorbikes (when applicable). Defined subtypes:
<ul>
<li><code>small</code> - e.g. kick bikes and children’s bikes.</li>
<li><code>standard</code> - a standard bike of some sort</li>
<li><code>wide</code> - normal in length, but wider. E.g. three wheel bikes, scooter.</li>
<li><code>long</code> - normal in width, but longer. E.g. a tandem cycle.</li>
<li><code>wideAndLong</code> - wider and longer than <code>standard</code>. E.g. a cargo bike.</li>
</ul></li>
<li><code>luggage</code> - Any carried luggage, including suite cases, backpacks, bags, shopping bags, etc. Only luggages <code>medium</code> or larger should be counted towards the “count”. Defined subtypes with <em>examples</em>:
<ul>
<li><code>xs</code> - A handbag, shopping bag, small backpack. Less than 15-20 litres.</li>
<li><code>small</code> - A small suitcase, large shopping bag, normal gym bag 25 - 50 litres.</li>
<li><code>medium</code> - A “normal” sized suitcase or similar. 50 - 75 litres.</li>
<li><code>large</code> - A larger suite case, backpack, etc. 75 - 100 litres.</li>
<li><code>xl</code> - Above 100 litres.</li>
</ul></li>
<li><code>animals</code> - only animals <code>medium</code> or larger should be counted towards the “count”.
<ul>
<li><code>small</code> - E.g. cats and lapdogs. Does not use capacity, but may not be permitted in some Spaces.</li>
<li><code>medium</code> - A “normal sized” dog or similar</li>
<li><code>large</code> - A large dog</li>
</ul></li>
<li><code>others</code> - Anything that does not fit into the categories, or could not be categorized.</li>
</ul>
<blockquote>
<p><strong><em>NOTE OAB:</em></strong> The reason I added <code>xs</code> and <code>small</code> for luggage was that while these are not useful for vehicle level occupancy, they could be used in <em>seat level</em> occupancy where one would like to know how many seats are taken by people putting a bag or similar on them.</p>
</blockquote>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Should we have sized-based subtypes for <code>others</code>? Like <code>small</code> - half adult sized, <code>medium</code> - adult sized, <code>large</code> - double adult sized, <code>xl</code> - multiple adults, <code>xxl</code> - more than one square meters.</p>
</blockquote>
<h4 id="mandatory-apc-object-types">5.4.3.1. Mandatory APC object types</h4>
<p>To be ITxPT compliant <code>adults</code>, <code>children</code> and <code>others</code> shall be supported. Object types that are not supported shall be absent from the structure. An example of a minimal object count structure below:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/apc-object-count.json&quot;</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;adults&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">9</span><span class="fu">},</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">},</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;others&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Subtypes are not mandatory, and the subtype <code>composition</code> shall be absent when not supported. When supported, but containing only <code>{"count": 0}</code> values, <code>"composition": null</code> <em>may</em> be used to reduce the transmission payload.</p>
<h3 id="passenger-count-triggers">5.4.4. Passenger Count Triggers</h3>
<p>An updated Passenger Count (any type) is produced for a reason. As part of the updated count, the reason for produced the update (at that moment) is provided, as a hint to analysis. While a trigger value is required, other values than those defined are allowed; trigger values that are not understood should be skipped by the analysis function, while still processing the count data.</p>
<p>By convention standardized triggers are UPPER CASE. Non-standard values should be lower case to not interfere with future standardization.</p>
<p><code>DOORS_CLOSED</code> - produced directly after a door close event.</p>
<p><code>DOORS_CLOSING</code> - produced while the doors are closing.</p>
<p><code>THRESHOLD</code> - produced after reaching some configured threshold, e.g. 10 entries+exits.</p>
<p><code>PERIODIC</code> - produced because a time period has elapsed since last produced.</p>
<p><code>COUNT_ADJUST</code> - the count has been adjusted, by a non-apc event. E.g. the driver has indicated the Vehicle is empty.</p>
<p><code>PROVIDER_RESET</code> - The producer has reset (intentionally or unintentionally) and start from “zero”.</p>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Should there be <code>DOORS_OPEN</code> trigger? While not useful for the counting as such, it could be useful for analysis of how long doors were open without pulling in further data.</p>
</blockquote>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Should there be <code>ALL_DOORS_CLOSED</code> trigger? Could be more descriptive for the SPACE COUNTS than <code>DOORS_CLOSED</code> that does not say which if doors close at different times.</p>
</blockquote>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Also discussed on meeting if <code>VEHICLE_MOVING</code> / <code>LEFT_STOP</code> would be useful. Don’t think it would be useful by current scope of APC spec that don’t know anything about movement, but it could be useful for higher level reports that does know about STOP PLACES and VEHICLE movement.</p>
</blockquote>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Are any of these TRIGGERS mandatory for ITxPT label? If yes, which?</p>
</blockquote>
<h3 id="passenger-entrance-count">5.4.5. PASSENGER ENTRANCE COUNT</h3>
<p>Number of entries/exits through a specific Entrance, for a specified <em>period</em> in time. Note that counts are cumulative since tsCountStart; to get the entries/exits for a smaller period, e.g. during a stop, the ‘before-value’ must be subtracted from the ‘after-value’. The use of cumulative counts means that the correct entries/exits of an entrance can be calculated even if some messages are lost.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-ENTRANCE-COUNT.json&quot;</span><span class="fu">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entranceId&quot;</span><span class="fu">:</span> <span class="st">&quot;door2&quot;</span><span class="fu">,</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;qf&quot;</span><span class="fu">:</span> <span class="st">&quot;HIGH&quot;</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entered&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;objectCount&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;exited&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;objectCount&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;trigger&quot;</span><span class="fu">:</span> <span class="st">&quot;DOORS_CLOSED&quot;</span><span class="fu">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T07:33:04&quot;</span><span class="fu">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tsCountStart&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T05:42:38&quot;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>entered and exited are cumulative counts. Once the Vehicle/Space goes empty -&gt; occupied -&gt; empty, the entered and exited count should - with perfect detection - be the same.</p>
<h3 id="passenger-space-occupancy-count">5.4.6. PASSENGER SPACE OCCUPANCY COUNT</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-SPACE-OCCUPANCY-COUNT.json&quot;</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;VIN1234566HJ&quot;</span><span class="fu">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;qf&quot;</span><span class="fu">:</span> <span class="st">&quot;HIGH&quot;</span><span class="fu">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;occupancy&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;objectCount&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;trigger&quot;</span><span class="fu">:</span> <span class="st">&quot;PERIODIC&quot;</span><span class="fu">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T07:33:48&quot;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Property “trigger” according to Passenger Count Triggers above.</p>
<p>“timestamp” is the time the Count was produced, or if production is not real-time the timestamp of the newest input data to the production.</p>
<h3 id="passenger-space-occupancy-ratio">5.4.7. PASSENGER SPACE OCCUPANCY RATIO</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-SPACE-OCCUPANCY-RATIO.json&quot;</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;VIN1234566HJ&quot;</span><span class="fu">,</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;qf&quot;</span><span class="fu">:</span> <span class="st">&quot;HIGH&quot;</span><span class="fu">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;occupancyRatio&quot;</span><span class="fu">:</span> <span class="fl">0.72</span><span class="fu">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;trigger&quot;</span><span class="fu">:</span> <span class="st">&quot;PERIODIC&quot;</span><span class="fu">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T07:33:48&quot;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Property “trigger” according to Passenger Count Triggers above.</p>
<p>“timestamp” is the time the Count was produced, or if production is not real-time the timestamp of the newest input data to the production.</p>
<h3 id="passenger-space-entrance-count">5.4.8. PASSENGER SPACE ENTRANCE COUNT</h3>
<p>Number of entries/exits through all entrances of a space. Has a spaceId instead of a sensorId/entranceId. Apart from that identical to PASSENGER ENTRANCE COUNT</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/PASSENGER-ENTRANCE-COUNT.json&quot;</span><span class="fu">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;car3&quot;</span><span class="fu">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;qf&quot;</span><span class="fu">:</span> <span class="st">&quot;HIGH&quot;</span><span class="fu">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;entered&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;objectCount&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;exited&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;objectCount&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;trigger&quot;</span><span class="fu">:</span> <span class="st">&quot;DOORS_CLOSED&quot;</span><span class="fu">,</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T22:33:30&quot;</span><span class="fu">,</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tsCountStart&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T05:42:38&quot;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="passenger-space-count-reset">5.5. Passenger Space Count reset</h2>
<p>When PASSENGER SPACE OCCUPANCY COUNTs are calculated using PASSENGER ENTRANCE COUNTs any bias in detection between the directions may over time lead to large error in reported occupancy. To minimize this problem, the standard includes an interface to reset PASSENGER SPACE OCCUPANCY COUNTs and PASSENGER SPACE OCCUPANCY COUNTs to a known count. This interface may be used by <em>any</em> function, manual or automatic, that wishes to (re)set the count to a known state.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/ITxPT/&lt;something&gt;/passenger-count-reset.json&quot;</span><span class="fu">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceId&quot;</span><span class="fu">:</span> <span class="kw">null</span><span class="fu">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;spaceType&quot;</span><span class="fu">:</span> <span class="st">&quot;VEHICLE&quot;</span><span class="fu">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2021-06-09T07:33:04&quot;</span><span class="fu">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;resetTo&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;see objectCount def&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;resetSource&quot;</span><span class="fu">:</span> <span class="st">&quot;MADTVehicleOccupancyEntry&quot;</span><span class="fu">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;resetSourceMsg&quot;</span><span class="fu">:</span> <span class="st">&quot;Driver marked vehicle as empty&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The structure includes the spaceId of the space to reset and in the <code>resetTo</code> property, the object count to reset to. If the spaceId is known the vehicleType does not need to match the type of the space.</p>
<p>If <code>"spaceId": null</code> then the count shall be reset of all PASSENGER SPACEs that matches vehicleType. This shall be supported for <code>VEHICLE</code> and <code>COMPOUND_TRAIN</code>. This is needed so systems requesting a reset does not need to understand the structure of PASSENGER SPACEs.</p>
<p>All APC Aggregators that produce PASSENGER SPACE OCCUPANCY COUNT or PASSENGER SPACE ENTRANCE COUNT shall monitor/accept reset messages. If the APC Aggregator also produces PASSENGER ENTRANCE COUNTs, e.g. as could be the case in a video based system, these should be reset at the same time.</p>
<p>Modules that only produce PASSENGER ENTRANCE COUNT should <em>not</em> monitor/accept reset messages, as resetting both APC Aggregator and its input at the same time, could cause a mismatch in data.</p>
<blockquote>
<p><strong><em>SPEC QUESTION:</em></strong> Not 100% sure “Modules that only produce PASSENGER ENTRANCE COUNT should <em>not</em> monitor/accept reset messages” is the right choice. On the other hand it keeps these modules/Providers simple, which is probably a considerable benefit <em>and</em> it avoids some possible race conditions between different modules/Providers getting the reset message.</p>
</blockquote>
<h1 id="transport-mqtt-using-json-format">6. Transport MQTT using JSON format</h1>
<p>The APC-II specification uses MQTT to transport messages with Format JSON. As this is a Data Centric specification more combinations of formats and transport could be added in the future, but no such needs have been identified for now.</p>
<h2 id="general-requirements">6.1. General Requirements</h2>
<p>All MQTT Providers specified in this specification and Consumers using this data shall follow the requirements for MQTT Clients in S02P00 (Info: this only exists as internal draft)</p>
<h2 id="security-considerations">6.2. Security Considerations</h2>
<p>The potential security impact of APC are low. Disrupted or incorrect APC data are unlikely to lead to any safety concerns or serious operational problems.</p>
<h2 id="performance-considerations">6.3. Performance Considerations</h2>
<p>For a simple vehicle there is unlikely to be more than half a dozen entrance sensors, sending a few messages per minute. Including an onboard APC aggregator, there should still be less than one message per second. A more complex vehicle like a bi-level EMU <em>may</em> have multiple messages per second in total, but this should have a negligible impact on performance.</p>
<p>Performance impact of APC is low.</p>
<h2 id="functional-group-and-provider-names">6.4. Functional Group and Provider Names</h2>
<p>APC has its own functional Group <code>apc</code>. (To Be Confirmed!)</p>
<p>APC has four types of providers:</p>
<p><code>apc_static</code> - data about the vehicle. This is not tied to a <code>apc_static</code> provider, and <em>may</em> be posted by/with any Provider (ID).</p>
<p><code>entrance_counts</code> - information about entry/exit for an entrance</p>
<p><code>space_counts</code> - information about entry/exit and occupancy for a space.</p>
<h2 id="mqtt-apc-topic-tree">6.5. MQTT APC Topic tree</h2>
<figure>
<img src="apc-topic-tree.png" alt="MQTT Topic Tree" /><figcaption aria-hidden="true">MQTT Topic Tree</figcaption>
</figure>
<h2 id="note-on-provider-ids">6.6. Note on Provider IDs</h2>
<p>If an entity publishes on multiple of the <code>*_counts</code> Providers it <em>may</em> use the Provider name <code>apc_counts</code> for all of them, rather than a separate Provider name/ID for each.</p>
<h2 id="static-data">6.7. Static Data</h2>
<p>Static data is published under <code>apc/apc_static</code>. There are no rules on which entities/providers publish the static data; as long as the needed static data is available it is within spec.</p>
<p>The <code>[spaceId]</code>, <code>[sensorId-entranceId]</code> and <code>[entranceId1-entranceId2]</code> part of the topics exists to separate data items of the same type and shall not be used by the clients. The Client shall use the Ids found in the the payload. Subscribes shall be to <code>..apc/apc_static/+/spaces/+/*</code>, <code>..apc/apc_static/+/sensor_entrance_mapping/+/*</code> and <code>..apc/apc_static/+/entrance_entrance_mapping/+/*</code>.</p>
<h2 id="entrance_counts-providers">6.8. <code>entrance_counts</code> Providers</h2>
<p>The <code>entrance_counts</code> Provider(s) are <em>not</em> required to be a physical sensors at each entrance. E.g. in a video based system the “video analysis engine” could provide <code>PASSENGER ENTRANCE COUNT</code>.</p>
<h3 id="inventory">6.8.1. Inventory</h3>
<p>In addition to what is required by Inventory MQTT (which is TBD) the provider shall <strong>TBD</strong>. (But probably something about how it is configured at least.)</p>
<h2 id="space_counts-providers">6.9. <code>space_counts</code> Providers</h2>
<h3 id="reset_request">6.9.1. reset_request</h3>
<p>The reset request can be published by anyone. It should be published on <code>apc/space_counts/reset_request/[spaceId]/..</code> if spaceId is set. If spaceId is null, it should be published on <code>apc/space_counts/reset_request/[vehicleType]/..</code>. APC Aggregators must subscribe to <code>apc/space_counts/reset_request/+/..</code>.</p>
<h3 id="inventory-1">6.9.2. Inventory</h3>
<p>In addition to what is required by Inventory MQTT (which is TBD) the provider shall <strong>TBD</strong>. (But probably something about how it is configured at least.)</p>
</body>
</html>
